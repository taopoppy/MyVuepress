# 科学上网

## 科学上网的原理

<img :src="$withBase('/online.png')" alt="online">

如上图所示，红色的墙`GWF`指的是长城防火墙，如果你想从大陆访问国外的服务器，比如访问`Google`,`YouTube`是不能直接访问的，因为被`GFW`阻断。但是有些国外的服务器是没有被`GFW`阻断的，我们可以先和这台服务器通信，然后通过这台服务器访问被阻断的服务器，这台服务器就是<font color=#3eaf7c>代理服务器</font>，通过代理服务器我们就可以间接的访问被阻断的访问器。

### 1. VPN
使用代理服务器有很多种，前几年比较流行的<font color=#3eaf7c>VPN</font>,它的中文意思是<font color=#3eaf7c>虚拟专用网</font>，最开始用于企业用途，比如你在外地出差，想要访问企业内部的服务`OA`或者`ERP`，可以通过vpn来访问企业内部,因为企业内部的服务是不能连接互联网的，那么企业就可以设置一台VPN服务器，配置两块网卡，一块连接企业内部网络，一块连接互联网，在外出差可以通过vpn来访问企业服务。

`VPN`有三种协议，`PPTP`,`L2TP`,`IPSec`,不过这三种协议已经在`GFW`的黑名单中了，所以你使用vpn上网可能使用几天就不能用了。

### 2. SSR
`SSR`是破娃酱在`SS`的基础上改进的一款科学上网的软件，无论是`SS`还是`SSR`都是使用`SOCKS5`协议，目前是一款比较稳定易用的科学上网工具。可以在[github官网](https://github.com/shadowsocksrr/shadowsocksr-csharp/releases)上去下载,下载.zip文件解压，然后点击`ShadowsocksR-dotnet4.0`，如果打不开可能你的电脑缺少`.net framework 4.0`，因为这个软件是使用C++和C#开发的

### 3. 操作流程
点击`ShadowsocksR-dotnet4.0`，然后你的电脑右下角会弹出一个小飞机的图标，初次打开是个白色的小飞机，而且初次打开是<font color=#3eaf7c>全局模式</font>还有<font color=#3eaf7c>服务器负载均衡</font>，特别要主要关掉这个服务器负载均衡，虽然名字听起来是对我们好的，但实际上可能会造成翻不了墙。

然后去掉负载均衡就会显示蓝色的小飞机，然后我们逐一讲解：

<font color=#3eaf7c>系统代理模式</font>：有三种连接模式分别是直连，PAC和全局模式，还有保持当前状态不修改
+ <font color=#3eaf7c>直连模式</font>：电脑不使用SSR连接代理，相当于你的电脑没有打开SSR软件
+ <font color=#3eaf7c>PAC模式</font>：就是利用PAC文件控制你的电脑流量
+ <font color=#3eaf7c>全局模式</font>：和直连模式相反，全局模式就是无论你是访问国外的网站（youtobe，google）还是国内的网站（百度，网易）,走的都是这个SSR代理

第二项<font color=#3eaf7c>PAC</font>有很多PAC文件的配置方式。直接去更新PAC是无法更新成功的，而且也不会有错误提示。刚才我们下载的ssr文件中是没有PAC文件的，你必须连接一个SSR节点才能更新成功。所以正确的做法是：<font color=#3eaf7c>我们在服务器->woocloud当中选择一个SSR节点，然后回到PAC选项中去选择'更新PAC为绕过局域网IP'</font>，如果更新不成功说明节点不能用，或者退出SSR重新打来。如果更新成功下方会显示`更新PAC成功`

更新成功后会在ssr文件夹中生成一个`pac`的文本文件，打开pac文件，你会发现里面有4个局域网网段，刚才你选择的是`绕过局域网IP`，意思就是你访问局域网中的WEB服务器，比如公司或者学校，流量是不会经过SSR代理节点的。

然后如果我们选择的是`更新PAC为绕过大陆常见域名列表`,或者`更新PAC为逃过大陆IP(慎用)`或者`更新PAC为仅通过大陆常见域名（国外访问大陆）`,这三个生成的pac文件中的域名列表是一样的，基本上这里包含的域名都是国内常见的地址和域名，你访问这些地址本身不需要翻墙，所以不走SSR流量的。假如你在国外想访问国内可以选择
`更新PAC为仅通过大陆常见域名（国外访问大陆）`

如果我们选择的是`更新PAC为GFWList`，pac文件中的域名或者地址都是已经被长城防火墙阻塞的，就是这些地址你不翻墙都访问不了的，包含我们常见的google、youtobe等等

`复制PAC URL`这个选项是什么意思？就是pac文件在你电脑中的路径，当然不是文件路径，是url路径，这个路径是可以在浏览器打开并下载的，下载的就是pac文件本身。这个通常用于你忘记ssr存储路径，暂时好像没有啥用

`编辑本地PAC文件`这个选项应该很好理解，它会打开pac文件的路径，然后你就可以编辑，可以向里面添加一下域名地址等等，比如你访问的国外的某个地址不在pac的域名列表，你就可以添加域名或者地址到pac文件中。

第三项<font color=#3eaf7c>代理规则</font>其实和系统代理模式差不多。

总之我们使用这个SSR软件基本就上通过上面三个选项：`系统代理模式`，`PAC`和`代理规则`进行流量的控制

### 4. 其他选项说明
1. **服务器**
SSR软件默认自带一个节点就是`FreeSSR-public`，当时也不是用的。然后我们可以自己有自己的机场，后面我们会推荐几个免费的机场

`编辑服务器`：会打开一个窗口，会显示所有服务器节点的列表，然后我们可以添加和删除服务器节点，当然我们使用SSR软件本身会在本机打开一个端口，端口就是1080,我们下面可以看一下这个窗口，然后看看服务器一些参数：
<img :src="$withBase('/SSRserver.png')" alt="SSRserver">
+ <font color=#CC99CD>服务器IP</font>：默认是看不到的，点击左边的小框框就能看到了，但是这个地址在浏览器是直接打不开的，但是在cmd中可以ping出来，而且通过ping这个地址可以看这个节点能不能用，还有通过时间可以看出延迟是多少，时间越少说明节点网络越好。如果有中断，那说明节点网络不太好。TTL指的系统，比如TTL=42指的是对方是linux系统
+ <font color=#CC99CD>服务器端口</font>：对面服务器，或者SSR节点使用的服务器的端口号
+ <font color=#CC99CD>协议、混淆</font>：更好的规避长城防火墙检测到这个流量
+ <font color=#CC99CD>SSR地址</font>：SSR地址，点击它，然后旁边会出来一个二维码

`从文件导入服务器`：这个其实一般是从一个json文件中导入服务器各种参数，一般是机场主干的事情

`优先相同节点连接同一个地址`：这个其实一般不会打开，本主也不知道有啥用

`服务器连接统计`：

## 获取机场（第一种方法：订阅）
下载ssr，上面都有说怎么下载。

+ 登录[http://ncucloud.ml/](http://ncucloud.ml/)注册账号，新用户可以免费试用3天,然后在用户中心的下面，我们会看到有普通节点订阅地址和单端口节点订阅地址，点击复制。回到小飞机，在系统代理模式选择PAC模式，然后在选项设置，在负载均衡中选择选中优先。点击服务器订阅，添加，添加刚才复制的网址，然后点击确定。右击小飞机，然后在服务器订阅中点击`更新SSR服务器订阅（不通过代理）`，更新成功会有通知，没有成功就多更新几遍。然后回到服务器，选择刚才那个免费的节点，然后就可以翻墙了

+ 然后本主有两个搜到的免费的订阅地址放在下面，如果有更多的订阅我也会在下面列举出来
  + `https://qiaomenzhuanfx.netlify.com`
  + `https://muma16fx.netlify.com`

## 免费节点获取（第二种方法：SSR节点方法）
1. [https://free-ss.site/](https://free-ss.site/)(需要翻墙)，虽然它在国内有镜像网站，但是常常被封掉，所以我们需要`镜像网站`之类的字眼，发邮件到这里[ss@rohankdd.com](ss@rohankdd.com)获取最新的镜像网站，很麻烦。我们可以同通过修改hosts文件来直接上这网站，在电脑的C盘>Windows>System32>drivsers>etc>hosts,记事本打开在最后输入`104.18.18.18  free-ss.site`即可

2. [https://www.ssrtool.com/tool/free_ssr](https://www.ssrtool.com/tool/free_ssr)(需要翻墙)，它的直连方式[https://www.eruo.ml/tool/free_ssr](https://www.eruo.ml/tool/free_ssr)

打开两个网站，然后开发二维码，然后用SSR客户端的二维码扫描去添加即可，第一次可能会不成功，我们还需要配置系统代理模式为PAC

另外对于`https://www.ssrtool.com/tool/free_ssr`这个网站的二维码一般扫描不上，我们只能用复制ssr的连接，然后在小飞机中点击`从剪贴板中批量导入ssr连接`


## 更简单的上网
直接到[官网](http://googlehelper.net/)下载`GHelper`插件到`chrome`浏览器，然后点击插件登陆注册即可

## 怎么加速下载百度网盘
+ 下载`chrome`浏览器插件：`Tampermonkey `
+ 到`https://bit.do/baidupan`，点击安装脚本，进入后再点击安装即可
+ 然后到网页版的百度网盘当中去生成链接

**参考资料**

1. [放弃VPN吧，目前最稳定的科学上网方式。电脑端SSR使用教程详解，花点耐心看完。翻墙原理以及VPN与SSR优劣比较，不再为翻墙发愁。授人与鱼不如授人与渔](https://www.youtube.com/watch?v=F6yh4b7ML5g)
2. [免费翻墙方法，两个机场，SSR节点，VPN科学上网教程2019](https://www.youtube.com/watch?v=QEkOhJlOSXE)
3. [iOS用户大福利，正版付费软件、游戏免费下载，包含Shadowrocket等多个翻墙工具](https://www.youtube.com/watch?v=p_bnMZD3YbM)




## 翻墙的原理

### 1. 防火墙是什么
防火墙（GFW）,俗称长城防火墙，是由于一些政治原因建立起立的，由于`Facebook`在08年前在网络上策划对中国西部恐怖袭击事件，结果`Facebook`以保护用户隐私为由拒绝了和中国政府的合作，这就是导火索


### 2. GFW的原理
一个网络请求在么有GFW的时候是这样的一个经过：
+ 发送出的请求包首先经过<font color=#9400D3>本地网络</font>
+ 再经过<font color=#9400D3>骨干网络</font>
+ 再经过<font color=#9400D3>DNS</font>，进行域名解析
+ 然后到达<font color=#9400D3>国际出口</font>，到达对应的服务器

但是存在GFW的时候，前面的步骤都是一样的，但是到了DNS的时候，就采取的一种手段：<font color=#DD1144>污染DNS</font>，因为如果你的请求是`http`的明文数据包，GFW就可以探测到流量的部分内容，一看你访问Google，于是就给你解析错误的地址。这也是另一种手段：<font color=#DD1144>关键词阻断</font>。还有另外一些手段，比如封锁端口等等，随着技术的发展，封锁的手段会更多。

### 3. VPN
合理的解决方案就是：<font color=#1E90FF>通过链接一台符合GFW认为合理的服务器作为中转，替代我想做的事情</font>，这就是初期<font color=#1E90FF>SSH代理</font>和<font color=#1E90FF>http代理</font>的原理所在，如下所示：

<img :src="$withBase('/fq1.png')" alt="">

+ 本地网络计算机发送一个请求建立加密通道的数据包，接入骨干网，域名解析，GFW发现你访问的是一个合理的国外地址，并非是`Google`或者`Facebook`
+ GFW放行后，数据包经过中装服务器解密出我真实要访问的地址，然后转到`Google`
+ `Google`返回数据给中转服务器，中转服务器再穿过墙返回给本地计算机。

这样做的关键首先是GFW是看不见我们加密的数据包，且认为我们访问的是国外一台允许的服务器，但是随着GFW的增强，根据这些有明显特征的流量做了两件事：
+ <font color=#1E90FF>屏蔽VPN需要的端口，除非你申请和报备</font>
+ <font color=#1E90FF>积累提供VPN的服务IP</font>

### 4.Shadowsocks
`Shadowsocks`是一个拐点，它引出了一个把代理服务器分成本地和远程的概念，实现经过`GFW`的流量全部加密，消除明显的流量特征，后来的<font color=#9400D3>SSR</font>和<font color=#9400D3>V2ray</font>都是类似的原理，我们先来看看：

<img :src="$withBase('/fq2.png')" alt="">

+ 同样是从本地计算机发出一个数据包给本地的`Shadowsocks`服务器发送数据加密请求（这里说的本地的`Shadowsocks`服务器指的就是你电脑上或者手机上装的翻墙软件，也可以是翻墙路由器或者软路由这些硬件），因为到这里是不过墙的，而且瞬间就能完成加密
+ 发送加密数据，经过DNS解析，通过骨干网到达国际出口，GFW因为探测不到具有明显特征的这个流量就选择放行。
+ 到达远程的中转服务器，也就是远程的`Shadowsocks`服务器，俗称自己的`vps`，或者机场的服务器
+ 远程服务器解密数据，转发给`Google`，拿到回应后同样向GFW发送加密数据，GFW也探测不到特征明显的流量也不是`http`的明文数据，选择放行
+ 返回的数据回到本地的`Shadowsocks`服务器，解密之后发送到本机

所以很多算法在GFW这里就是用来伪装和消除这种流量特征，和`VPN`的模式相比，最大的区别在于`VPN`的特征很明显，过墙的数据很遵循一个固定的套路，都是先发送一个建立加密通道的数据包，而`Shadowsocks`则在本地就完成了加密，过墙的数据已经被加密，所以GFW无法探测到这种没有明显特征的流量

### 5. 翻墙的方式和优劣
翻墙分为三种：
+ <font color=#1E90FF>软件翻墙</font>
+ <font color=#1E90FF>硬件翻墙（路由翻墙）</font>
+ <font color=#1E90FF>网关模式翻墙</font>

<font color=#1E90FF>**① 软件翻墙-vpn**</font>

很多人把翻墙理解为`VPN`，其实是不对的，因为`VPN`的初衷并不是翻墙，全称叫做虚拟私有网络，根据私密通讯这个需求产生的，你和客户需要一条私密的沟通渠道，但是不想去购买或者租用跨国的网络专线。`VPN`的好处就是端对端的方式，避免通讯流量被中间劫后泄密。所以GFW是无法通过明文或者中间劫持的，但是特征太过于明显，现在使用VPN已经很不安全了，因为对于私人来说，不通过申请和报文许可的`vpn`，而购买私人小厂的`vpn`，很容易就被封了。

<font color=#1E90FF>**② shadowsocks以衍生品**</font>

前面说了`shadowsocks`的原理，但是对于GFW并不是通过劫持流量来判断的，而是通过判断流量特征，所以无论什么加密手法，什么特征流量，都并不是100%安全的。所以越新的协议和算法意味着相对安全。

<font color=#DD1144>软件方式的翻墙手段，有一个明显的缺点，就是很多软件都没有那么高的底层权限，只能代理应用层的网络流量，所谓的全局代理只是翻墙软件本身所接管到的所有流量，可以转发到代理服务器，但是有的软件跑在系统层，权限更高，甚至不遵循操作系统的代理规则，根本不把通讯流量，交给翻墙软件接管。比如说windows商店下载的UWP应用就无法通过你的翻墙软甲进行翻墙，而像浏览器，postman这种浏览量，软件本身产生的流量是可以交给翻墙软件进行代理的</font>

<font color=#1E90FF>**③ 硬件翻墙-路由器**</font>

路由器翻墙是可以实现真正的全局翻墙的，也就是所有的流量都会被强制代理，<font color=#1E90FF>路由器翻墙简单的说就是你把翻墙软件部署在了路由器上面</font>。

最突出的优点就是可以帮助无法安装翻墙软件的设备进行翻墙，比如一些VR设备，switch等，这样的话理论上能够连接路由器的设备都能翻墙。

缺点也很明显，因为路由器的算力很难解决复杂的加密解密计算，也就导致了网络通讯会产生卡顿，所以普通的路由器是一定存在性能瓶颈的问题，所以就引出了<font color=#9400D3>软路由</font>的概念，软路由就是改造过的路由器，类似于小型的计算机。缺点就是贵，而且操作起来比较繁琐和复杂

<font color=#1E90FF>**④ 网关翻墙**</font>

最推荐的一个上网方式，网关模式，<font color=#DD1144>可以理解为在你的局域网里面，不需要一个专属的路由器或者软路由这样的硬件，而是通过一台计算机上跑的软件，来实现路由器的功能</font>，比较有代表性的就是`Windows`下的`clash`，`Mac`操作系统下的`Surge`，在你的本地局域网当中部署了一台运行`Surge`或者`Clash`的电脑当做网关，可以接管局域网里面其他所有网络设备的所有流量同时翻墙。<font color=#DD1144>这种方式完美的解决了一些流量不走翻墙软件，不遵循系统代理规则</font>

这种方式非常方面，切换节点或者调试都是在电脑里的软件，不需要进行登录路由器后台等等，只需要点点鼠标即可

<font color=#DD1144>这里介绍一下怎么使用clash和使用clash的tun模式做全局代理的两个视频地址</font>

+ [https://www.youtube.com/watch?v=A6Z7Mg2ULPI](https://www.youtube.com/watch?v=A6Z7Mg2ULPI)
+ [https://www.youtube.com/watch?v=HaIbW32wGbg](https://www.youtube.com/watch?v=HaIbW32wGbg)

还有能通过`clash`的`tun`模式实现全家设备上网的方法：
+ [https://www.youtube.com/watch?v=z1WNcmX3hlA](https://www.youtube.com/watch?v=z1WNcmX3hlA)

### 6. 线路
<font color=#1E90FF>**① CN2线路**</font>

`CN2`指的是`CNCN`，意思就是中国电信下一代承载网络，相比我们现在使用的老一代的163骨干网，更加的通常，也搭载了很先进的`QoS`技术，<font color=#1E90FF>可以根据服务内容进行网络带宽的调节</font>，163骨干网是做不到的，其中分为`CN2GT`和`CN2GIA`，很多游戏加速使用的就是`CN2`，但是注意的是，你如果在供应商买`CN2`的话，一定注意是单向还是双向，因为有些无良供应商会给你提供单向，相当于你出的时候是`CN2`，但是回来的时候还是163.

<font color=#1E90FF>**② BGP协议**</font>

全称为边界网关协议，`BGP`机房一般也叫作多线机房。

<font color=#1E90FF>**③ 三大线路**</font>

三大巨头线路：
+ <font color=#9400D3>GCP</font>：谷歌
+ <font color=#9400D3>AWS</font>：亚马逊
+ <font color=#9400D3>Azure</font>：微软

+ `PCCW`线路是香港的，所有应该去优先选择
+ `IPLC`线路是奇贵无比的，而且水更深，流量倍率很高，但是游戏加速效果最好，因为不用翻墙，`IPLC`是不过墙的

所以通常是不建议自己搭建`VPS`的，因为大的机场会更高效

### 7. 合适的方式
自己挑选`vps`的难度在哪里？
+ <font color=#1E90FF>过程繁琐</font>：需要自己挑选`VPS`主机，大多数都会选择`Linode`，`Vultr`，`bandwagon`（搬瓦工），选好供应商之后就开始挑选线路，比如`BGP`之类的，如果使用伪装的方式，还需要选择域名，改A记录，然后尝试加密和协议，使用`SS`或者`SSR`大多数用不了几天，因为`GFW`对海外大供应商的监控开始重点统计。

+ <font color=#1E90FF>华而不实</font>：表面上有很多人都在自建`vps`，但是实际上这些人都是，要么是发烧友，要么是骗钱的

所以翻墙一点要选择大机场，不要选择`VPS`或者小机场。而且大机场买来一定要先试用，机场的大小实际上你无从判断，只能尝试。尝试的时间一定要在周末晚上这种高峰期。

### 8. 协议之战
`shadowsocks`目前依然是主流的翻墙方式，`shadowsocksr`是前者的优化版，但是并不代表的前者就不安全，就不好用，因为两者并非一个作者。

而`V2ray`的复杂性其实更高，安全性也相对高，其花样也多，涉及到最新的花样`V2ray`+`websocket`+`tls`+`web`的原理，通过伪装访问网站的方式，来伪装流量特征。

但是话又说回来，GFW的封锁并不是简单的技术封锁，还是特征封锁，即便是最新的`V2ray`技术，伪造访问正常网站的流量，但是如果天天请求，那么GFW就会发现特征，以为你天天都在访问同一个地址，即便请求无论从目标，协议和流量和明文都没有问题，但是你访问的这个特征已经被嗅探到了。
，
所以即便是`V2ray`弹性大，功能多，支持的协议和算法多，部署难度和算力都比较高，也都不是最安全的，从博弈的角度看，没有绝对胜利的一方。

`trojan`是解决了`V2ray`的一些缺点，走的是轻量化的方案，但是产生的流量特征和`websocket`+`tls`是么有太大区别的。`trojan`只使用了`tls`加密，相比于`V2ray`的`vmess`会更快一些，无论是加解密或者算力来说。<font color=#DD1144>所以一个简单的理解就是：trojan是一个简化版的v2ray</font>，但是缺点也明显，因为协议是单一的，弹性就差，而且兼容性很差


总结：
+ <font color=#1E90FF>shadowsockets协议依然适合绝大多数机场用户使用</font>
+ <font color=#1E90FF>vps用户建议优先选择相对比较安全的v2ray</font>
+ <font color=#1E90FF>对速度有严格要求的，选择trojan</font>

所以学习基础技能，掌握原理，动态的取舍才是科学上网的方式。

### 9.主流和非主流
你可能想不到，实际上在中国，大部分翻墙的都是`vpn`，因为需要的差异，其实对于长期稳定翻墙的用户，`sock5`代理的`ss`,`ssr`，`V2ray`还有`trojan`才是最好的方式。

但是`vpn`是可以实现真正的全局代理，因为`vpn`在网络层级当中无限接近最底层，相当于建立了一个虚拟网卡，网络设备上几乎所有的流量都可以被强制接管。
而`sock5`在网络中属于应用层的会话层，所以很多流量实际上无法代理。

<img :src="$withBase('/fq3.png')" alt="">

所以如上图，你可以看到数据是从上往下传递的，所以对于浏览器，email等等产生的数据流量会被会话层的翻墙软件劫持，但是比如说处于传输层和网络层直接产生的网络流量或者不遵从系统代理的软件产生的流量，会话层就接管不了。

虽然处于数据链路层的`vpn`几乎可以做到真全局代理，但是其流量特征被GFW完美封锁，只有一些海外的VPN在通过不端更换IP的方式来续命

// 未完待续，第九期完
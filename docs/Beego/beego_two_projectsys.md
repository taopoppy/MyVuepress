# 项目架构需求分析

## 大型Web设计概要
实际上对于大型`Web`项目来说，项目从最开始并不是说由经验特别丰富的架构师一开始就设计好，没有有有这么强大的整个构思能力，所以我们首先知道：<font color=#DD1144>Web架构是一种演进路线，并非一蹴而就</font>

所以`Web`架构的演进有两个特点:
+ <font color=#1E90FF>像微风</font>:一起都恰如其分,架构是刚刚好能满足当前的业务需求,没有多余的工作。为什么说是这样呢，比如我们最开始就估测有一个10pv的app，但是我们没有必要一开始就做一个千万级别的架构，因为大型`Web`架构就是海上的冰山,用户只能看到冰山一角,海面下的绝大部分用户看不见,但需要更多的工程师要做的工作,在快速迭代和敏捷开发中,架构的搭建势必会影响业务的快速迭代,所以架构永远是随着业务的迭代和发展才逐渐变大的。<font color=#1E90FF>不要从一开始就做一个很过分的架构，刚刚好即可</font>

+ <font color=#1E90FF>像河流</font>：业务是发展的，我们的架构要能走在业务迭代之前的一到两步，所以也是循序渐进的过程

下面我们就介绍一下不同时期的架构方式，从简单到深入体会和了解一下架构的演进：

### 1. 初始阶段的架构

<img :src="$withBase('/beego_two_chushijiagou.png')" alt="初始阶段的架构">

+ 最开始比如我们自己搭建博客，我们可以从云厂商买一个服务器，然后我们的服务，数据库，还有用到的静态资源，下载文件都能够放在这里，而且如果博客只有自己看，没有太大访问量，应用服务器和整个架构都不需要太复杂。

### 2. 应用服和数据服分离

<img :src="$withBase('/beego_two_yingyongshuju.png')" alt="应用服和数据服分离">

+ 但是随着功能和业务增加，首先遇到的瓶颈就是数据库的瓶颈。所以我们需要做上面的这种拆分工作，我们需要将数据库单独放在一个服务器上，或者自己造，或者使用<font color=#1E90FF>阿里的DB服务</font>和<font color=#1E90FF>容器服务</font>等等

### 3. 数据库读写分离

<img :src="$withBase('/beego_two_zhucongfuzhi.png')" alt="数据库读写分离">

+ 随着用户访问量的逐渐增加，<font color=#1E90FF>数据库首先会遇到读写的瓶颈</font>，所以我们需要一台或者多台读取服务器，面对应用服务器的请求，可以分散数据库整体的压力，<font color=#1E90FF>当然如果有多台从服务器，可以单独拿出一台作为备份服务器，当主服务器挂了之后可以热接上去</font>

### 4. 使用缓存和搜索引擎

<img :src="$withBase('/beego_two_cacheseach.png')" alt="缓存和搜素引擎">

+ 随着首页访问的次数增加，拉取数据的质量越大，次数也更加频繁，这个时候就可以这样做：<font color=#DD1144>将从数据库拉取的这些相同的数据放在一个缓存区中，这个缓存可以是单独的一个缓存服务器，也可以直接放在应用服务器的内存中</font>，内存读取是远快于硬盘读取的，所以读取内存中的内容比从数据库中读取内容要高出一到两个等级，快的就不是一点半点了。所以：<font color=#DD1144>数据库读写分离和加入缓存是我们最常见的两种提高读写速率的方式</font>

+ 搜索是什么呢，现在大多数`Web`应用有很多全文检索的功能,使用数据库来做会比较消耗资源,而已很慢,使用专业的搜索引擎服务会更快一些。

### 5. 反向代理和CDN

<img :src="$withBase('/beego_two_fanxiangdaili.png')" alt="反向代理和CDN">

+ 现在比如说文件服务器在北京，对于北京的用户下载链路比较短，但是对于比较远的用户下载链路就很长，所以我们需要接入`CDN`服务器，它在各个区域都有缓存的节点，会根据你最近的节点来选择下载。
+ 反向代理服务器是什么呢， 比如美国的一个用户通过<font color=#1E90FF>公网</font>来访问应用服务器，非常慢，那么就在美国搭建一个反向代理服务器，然后通过<font color=#DD1144>机房专线</font>来反向请求我们的服务，然后将响应返回给用户

### 6. 使用网站集群改善并发

<img :src="$withBase('/beego_two_fuzaijunheng.png')" alt="使用网站集群改善并发">

+ 当我们的其他都优化了，瓶颈就会发生在应用服务器上面，我们需要这样做：<font color=#DD1144>将我们的服务做成可平行扩展，可以做一个集群架构的这样的服务</font>

## 项目具体需求分析
对于我们的项目，我们有两个大的模块：
+ <font color=#DD1144>读书</font>：
  + <font color=#1E90FF>首页分类详情</font>：分类首页、分类详情、图书详情
  + <font color=#1E90FF>阅读器</font>：章节&内容、章节搜索
  + <font color=#1E90FF>搜索</font>：创建索引、内容搜索
  + <font color=#1E90FF>图书编辑</font>：编辑图书属性、章节内容编辑、创建&删除章节、上传&删除附件
  + <font color=#1E90FF>管理员后台</font>：站点设置，分类设置
  + <font color=#1E90FF>图书管理&设置</font>：我的图书、创建图书、图书设置
+ <font color=#DD1144>用户</font>：
  + <font color=#1E90FF>社交中心</font>：个人主页，关注，评论&评分、粉丝、收藏
  + <font color=#1E90FF>登录&权限</font>：注册，登录&登出、权限管理
  + <font color=#1E90FF>个人设置</font>

我们下面通过一个比较完整的图示来看一下各个模块的依赖和关系，然后我们下面就开始正式的搭建整个大型的`Web`的架构：

<img :src="$withBase('/beego_two_projectfenlei.png')" alt="图书模块的关系">
